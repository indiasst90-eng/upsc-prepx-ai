# Story 9.9: Smart Bookmark System - Spaced Repetition Reminders

**Epic:** 9 - Advanced Learning Tools - Mindmaps, Bookmarks & Assistants
**Story Number:** 9.9
**Status:** COMPLETE
**Created:** December 23, 2025
**Sprint:** Sprint 10 (Epic 9)
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** scheduled reminders to review my bookmarks using spaced repetition,
**so that** I retain important information long-term.

---

## Acceptance Criteria

1. Spaced repetition: implements SM-2 algorithm for optimal review scheduling
2. Initial schedule: review after 1 day, 3 days, 7 days, 14 days, 30 days, 60 days
3. Database: adds next_review_date, review_count, ease_factor fields to `bookmarks` table
4. Daily scan: Edge Function `bookmark_review_reminder_pipe.ts` runs daily to identify due bookmarks
5. Notification: sends push notification "5 bookmarks are due for review today!"
6. Review interface: /bookmarks/review displays today's due bookmarks in quiz-like format
7. Review action: users mark understanding (Easy/Medium/Hard), updates next_review_date accordingly
8. If "Hard": schedules next review sooner (reduces ease_factor)
9. If "Easy": schedules next review later (increases ease_factor)
10. Completion tracking: shows streak of consecutive days reviewing bookmarks

---

## Dependencies

**Blocking:** Stories 9.7, 1.3 (bookmarks system, database)
**Blocks:** Story 9.10

---

## Definition of Done

- [x] All AC met
- [x] Spaced repetition working
- [x] Reminders sent correctly
- [x] Review interface functional
- [x] Tests passing

---

## Implementation Summary

### Database (Migration 051)
- Added review fields to bookmarks: next_review_date, review_count, ease_factor, interval_days
- `bookmark_reviews` table for history
- `review_streaks` table for tracking consecutive days
- SM-2 algorithm functions: calculate_sm2_interval, process_bookmark_review
- Auto-initialize trigger on bookmark creation

### API (`/api/bookmarks/review/route.ts`)
- GET: Fetch due bookmarks and streak info
- GET ?action=count: Due count for notifications (AC 5)
- POST: Submit review with Easy/Medium/Hard/Again (AC 7-9)
- PUT: Batch actions (initialize, snooze)

### UI (`/bookmarks/review/page.tsx`)
- Quiz-like flashcard interface (AC 6)
- Show Answer reveal with Space key
- 4 response buttons with emoji feedback (AC 7)
- Keyboard shortcuts 1-4 for responses
- Progress bar and session stats
- Streak display with fire emoji (AC 10)
- Completion celebration screen

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 2.0 | Implementation complete - SM-2 algorithm, all 10 ACs | Dev Agent |
