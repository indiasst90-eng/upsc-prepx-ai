# Story 3.6: Daily CA PDF Summary & MCQ Generation

**Epic:** 3 - Video Generation Pipeline
**Story Number:** 3.6
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 4
**Estimated Effort:** Medium (M)
**Risk Level:** MEDIUM

---

## Story

**As a** UPSC aspirant,
**I want** a downloadable PDF summary of daily current affairs with 5 practice MCQs,
**so that** I can review in text format and test my understanding.

---

## Acceptance Criteria

1. PDF generated automatically after video publish
2. PDF structure: cover page → summary (topic-wise bullets, 2-3 pages) → MCQs (5 questions)
3. MCQs generated by LLM: 4 options each, mix of Prelims/Mains style
4. Answers provided at end with explanations
5. PDF styled with branding: logo, Neon Glass theme colors
6. Download button on video page
7. PDF uploaded to Supabase Storage: pdfs/daily-ca/{YYYY-MM-DD}.pdf
8. PDF cached for 7 days, archived after 30 days
9. Generation time: <2 minutes
10. Mobile-optimized PDF viewing

---

## Dependencies

**Blocking:** Story 3.5
**Blocks:** None

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Edge Functions: `packages/supabase/functions/pipes/generate_ca_pdf_pipe/`
- Frontend Components: `apps/web/src/components/daily-ca/PDFViewer.tsx`
- Storage: Supabase Storage bucket `pdfs/daily-ca/`

### Data Models

**Database Schema:**
```typescript
interface DailyCAPDF {
  id: UUID
  date: DATE
  pdf_url: TEXT
  file_size_bytes: INTEGER
  mcq_count: INTEGER  -- 5 MCQs
  generated_at: TIMESTAMPTZ
  cached_until: TIMESTAMPTZ
}
```

### API Specifications

**Edge Function:** `generate_ca_pdf_pipe`
- Location: `packages/supabase/functions/pipes/generate_ca_pdf_pipe/index.ts`
- Trigger: After video publish (Story 3.5)
- Performance: <2 minutes generation time

### Testing Standards

**Test File Location:**
- Unit Tests: `packages/supabase/functions/pipes/generate_ca_pdf_pipe/index.test.ts`

---

## Tasks / Subtasks

- [ ] **Task 1: PDF Generation Pipe (AC: 1, 9)**
  - [ ] 1.1 Create `generate_ca_pdf_pipe/index.ts`
  - [ ] 1.2 Triggered after Story 3.5 completes
  - [ ] 1.3 Target generation time: <2 minutes
  - [ ] 1.4 Generate PDF using puppeteer or react-pdf

- [ ] **Task 2: PDF Content Structure (AC: 2)**
  - [ ] 2.1 Create PDF template with cover page
  - [ ] 2.2 Cover: Date, "Daily Current Affairs", branding
  - [ ] 2.3 Summary section: topic-wise bullets, 2-3 pages
  - [ ] 2.4 Apply Neon Glass theme styling

- [ ] **Task 3: MCQ Generation (AC: 3-4)**
  - [ ] 3.1 Create `generateMCQs()` function
  - [ ] 3.2 LLM generates 5 MCQs based on today's content
  - [ ] 3.3 Mix of Prelims (factual) and Mains (analytical) style
  - [ ] 3.4 Each MCQ: question + 4 options (A, B, C, D)
  - [ ] 3.5 Answers with explanations at end

- [ ] **Task 4: Download Button (AC: 6)**
  - [ ] 4.1 Create `PDFDownloadButton.tsx` component
  - [ ] 4.2 Add to video page and daily-ca pages
  - [ ] 4.3 Track download analytics

- [ ] **Task 5: Storage & Caching (AC: 7-8)**
  - [ ] 5.1 Upload PDF to Supabase Storage
  - [ ] 5.2 Path: `pdfs/daily-ca/{YYYY-MM-DD}.pdf`
  - [ ] 5.3 Cache for 7 days
  - [ ] 5.4 Archive after 30 days (move to archived folder)

- [ ] **Task 6: Mobile Optimization (AC: 10)**
  - [ ] 6.1 Ensure PDF renders well on mobile
  - [ ] 6.2 Compress images for smaller file size
  - [ ] 6.3 Test PDF opening in mobile browsers

- [ ] **Task 7: Unit Tests**
  - [ ] 7.1 Test PDF structure
  - [ ] 7.2 Test MCQ format
  - [ ] 7.3 Test generation time <2 min

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft → **Ready for Review**
