# Story 2.6: Notes Library - Organization & Export

**Epic:** 2 - Core Learning Features
**Story Number:** 2.6
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 3
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** a centralized notes library where I can browse, search, and export all my generated notes,
**so that** I can organize my study materials and access them offline.

---

## Acceptance Criteria

1. Notes Library page: /notes route with grid view of note cards
2. Card displays: topic title, level badge, thumbnail (first diagram or placeholder), created date, View button
3. Filters: subject dropdown, paper dropdown, level checkboxes, date range picker
4. Search bar: full-text search across note content using PostgreSQL tsvector
5. Sorting: by date (newest/oldest), topic (alphabetical), level (summary first)
6. Pagination: 20 notes per page, infinite scroll on mobile
7. Bulk actions: select multiple notes, bulk export as ZIP (all PDFs), bulk delete
8. Individual note export: PDF download button generates PDF with proper formatting
9. Markdown export: download as .md file with cross-links preserved
10. Offline access (PWA): downloaded notes cached for offline viewing, sync indicator

---

## Dependencies

**Blocking:** Story 2.3
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Notes library page functional
- [ ] All filters working
- [ ] Search working
- [ ] Export (PDF, Markdown, ZIP) functional
- [ ] Offline access working
- [ ] Mobile tested

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Pages: `apps/web/src/app/(dashboard)/notes/library/page.tsx`
- Frontend Components: `apps/web/src/components/notes/`
- Export Utils: `apps/web/src/lib/export-utils.ts`

### Data Models

**Database Query:**
- `comprehensive_notes` table with filters on subject, paper, level, date

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/notes/**/*.test.tsx`
- E2E Tests: `tests/notes-library.spec.ts`

---

## Tasks / Subtasks

- [ ] **Task 1: Notes Library Page (AC: 1)**
  - [ ] 1.1 Create `apps/web/src/app/(dashboard)/notes/library/page.tsx`
  - [ ] 1.2 Grid view layout for note cards
  - [ ] 1.3 Responsive design (grid cols: 1 mobile, 2 tablet, 3 desktop)

- [ ] **Task 2: Note Card Component (AC: 2)**
  - [ ] 2.1 Create `NoteCard.tsx`
  - [ ] 2.2 Display: topic title, level badge, thumbnail, created date, View button
  - [ ] 2.3 Level badge colors: summary (green), detailed (blue), comprehensive (purple)

- [ ] **Task 3: Filters UI (AC: 3, 5)**
  - [ ] 3.1 Create `NotesFilters.tsx` component
  - [ ] 3.2 Subject dropdown, paper dropdown
  - [ ] 3.3 Level checkboxes: Summary, Detailed, Comprehensive
  - [ ] 3.4 Date range picker
  - [ ] 3.5 Apply filters to note query

- [ ] **Task 4: Search Functionality (AC: 4)**
  - [ ] 4.1 Create `notesSearchPipe` Edge Function
  - [ ] 4.2 Full-text search using PostgreSQL tsvector
  - [ ] 4.3 Search across note content
  - [ ] 4.4 Real-time search results

- [ ] **Task 5: Sorting & Pagination (AC: 5, 6)**
  - [ ] 5.1 Create `SortDropdown.tsx` component
  - [ ] 5.2 Options: date (newest/oldest), topic (alphabetical), level
  - [ ] 5.3 Implement pagination: 20 notes per page
  - [ ] 5.4 Infinite scroll on mobile

- [ ] **Task 6: Bulk Actions (AC: 7)**
  - [ ] 6.1 Create bulk selection UI (checkboxes on cards)
  - [ ] 6.2 Bulk export as ZIP (containing all PDFs)
  - [ ] 6.3 Bulk delete with confirmation

- [ ] **Task 7: PDF Export (AC: 8)**
  - [ ] 7.1 Create `generatePDF()` function (use react-pdf or jsPDF)
  - [ ] 7.2 Format: proper typography, diagrams, source citations
  - [ ] 7.3 Download button on each note card

- [ ] **Task 8: Markdown Export (AC: 9)**
  - [ ] 8.1 Create `exportToMarkdown()` function
  - [ ] 8.2 Preserve cross-links and formatting
  - [ ] 8.3 Download as .md file

- [ ] **Task 9: Offline Access (AC: 10)**
  - [ ] 9.1 Configure PWA service worker
  - [ ] 9.2 Cache downloaded notes for offline viewing
  - [ ] 9.3 Sync indicator showing offline/online status

- [ ] **Task 10: Unit Tests**
  - [ ] 10.1 Test note filtering logic
  - [ ] 10.2 Test export formats
  - [ ] 10.3 Test pagination

- [ ] **Task 11: E2E Testing**
  - [ ] 11.1 Test library navigation
  - [ ] 11.2 Test export workflow

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
