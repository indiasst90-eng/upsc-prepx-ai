# Story 3.10: Admin - Daily CA Override & Manual Edit

**Epic:** 3 - Video Generation Pipeline
**Story Number:** 3.10
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 4
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As an** admin,
**I want** to manually edit auto-generated daily CA scripts and override automation when needed,
**so that** I can ensure content quality and fix errors before publishing.

---

## Acceptance Criteria

1. Admin dashboard route: /admin/daily-ca with list of all daily CA videos
2. Edit script: text editor for modifying auto-generated script before rendering
3. Preview changes: see updated script with word count and estimated duration
4. Manual article addition: add/remove articles from daily selection
5. Regenerate video: trigger re-render with edited script
6. Delay publication: admin can hold video from auto-publish
7. Manual publish: admin can manually publish after review
8. Edit history: log all manual edits with admin name and timestamp
9. Scheduled override: admin can schedule future CA content in advance
10. Bulk operations: mark multiple dates for manual content

---

## Dependencies

**Blocking:** Stories 3.2, 3.5
**Blocks:** None

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Admin Pages: `apps/admin/src/app/daily-ca/`
- Admin API: `packages/supabase/functions/pipes/admin_daily_ca_pipe/`

### Data Models

**Database Schema:**
```typescript
interface DailyCAOverride {
  id: UUID
  date: DATE
  override_type: TEXT  -- 'manual_script', 'manual_articles', 'hold_publication', 'scheduled'
  original_script?: TEXT
  edited_script?: TEXT
  article_overrides: JSONB  -- { added: [], removed: [] }
  is_published: BOOLEAN DEFAULT false
  published_at?: TIMESTAMPTZ
  edit_history: JSONB  -- [{ admin_id, change, timestamp }]
  created_at: TIMESTAMPTZ
}
```

### API Specifications

**Admin Pipe:** `admin_daily_ca_pipe`
- Location: `packages/supabase/functions/pipes/admin_daily_ca_pipe/index.ts`
- Methods: GET (list), PUT (edit script), POST (publish), DELETE (hold)
- Auth: Admin role required

### Testing Standards

**Test File Location:**
- Unit Tests: `packages/supabase/functions/pipes/admin_daily_ca_pipe/index.test.ts`

---

## Tasks / Subtasks

- [ ] **Task 1: Admin Dashboard (AC: 1, 32)**
  - [ ] 1.1 Create `apps/admin/src/app/daily-ca/page.tsx`
  - [ ] 1.2 List all daily CA videos with status
  - [ ] 1.3 Calendar view for easy navigation
  - [ ] 1.4 Quick actions: Edit, Hold, Publish

- [ ] **Task 2: Script Editor (AC: 2, 3)**
  - [ ] 2.1 Create `ScriptEditor.tsx` component
  - [ ] 2.2 Full text editor for script modification
  - [ ] 2.3 Show word count and estimated duration
  - [ ] 2.4 Highlight changes from original

- [ ] **Task 3: Article Management (AC: 4)**
  - [ ] 3.1 Create `ArticleSelector.tsx` component
  - [ ] 3.2 List articles available for today
  - [ ] 3.3 Add/remove articles from daily selection
  - [ ] 3.4 Preview article content

- [ ] **Task 4: Regenerate Video (AC: 5)**
  - [ ] 4.1 Create `regenerateVideo()` function
  - [ ] 4.2 Trigger re-render with edited script
  - [ ] 4.3 Show render progress
  - [ ] 4.4 Update status after completion

- [ ] **Task 5: Publication Control (AC: 6-7)**
  - [ ] 5.1 "Delay Publication" toggle
  - [ ] 5.2 "Manual Publish" button
  - [ ] 5.3 Status: auto-publish vs manual
  - [ ] 5.4 Notifications on manual publish

- [ ] **Task 6: Edit History (AC: 8)**
  - [ ] 6.1 Log all manual edits
  - [ ] 6.2 Include: admin_id, change description, timestamp
  - [ ] 6.3 Display edit history on page
  - [ ] 6.4 Ability to revert changes

- [ ] **Task 7: Scheduled Override (AC: 9)**
  - [ ] 7.1 Create `ScheduledContentModal.tsx`
  - [ ] 7.2 Schedule future CA content
  - [ ] 7.3 Select date, add articles, set script
  - [ ] 7.4 Queue for automated processing

- [ ] **Task 8: Bulk Operations (AC: 10)**
  - [ ] 8.1 Select multiple dates
  - [ ] 8.2 Bulk mark for manual content
  - [ ] 8.3 Bulk export history
  - [ ] 8.4 Bulk status update

- [ ] **Task 9: Admin API**
  - [ ] 9.1 Create `admin_daily_ca_pipe/index.ts`
  - [ ] 9.2 Verify admin role
  - [ ] 9.3 Implement CRUD operations
  - [ ] 9.4 Audit logging

- [ ] **Task 10: Unit Tests**
  - [ ] 10.1 Test script editing
  - [ ] 10.2 Test article selection
  - [ ] 10.3 Test publication control
  - [ ] 10.4 Test edit history logging

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
