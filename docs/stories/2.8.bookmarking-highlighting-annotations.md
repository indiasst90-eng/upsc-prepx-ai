# Story 2.8: Bookmarking, Highlighting & Annotations

**Epic:** 2 - Core Learning Features
**Story Number:** 2.8
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 3
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** to bookmark topics, highlight text in notes, and add personal annotations,
**so that** I can mark important information and create personalized study aids.

---

## Acceptance Criteria

1. Bookmark button on every syllabus topic and search result
2. Bookmarked topics saved to bookmarked_topics table
3. My Bookmarks page lists all bookmarks with filters
4. Text selection in notes reveals highlight toolbar
5. Highlight colors: yellow (default), green, pink, blue
6. Highlights saved per user with position data
7. Annotation text box appears on highlight click
8. Annotations saved to note_annotations table
9. Export bookmarks and highlights to PDF
10. Sync across devices via database

---

## Dependencies

**Blocking:** Stories 2.3, 2.6
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Bookmark functionality working
- [ ] Text highlighting working
- [ ] Annotations working
- [ ] Export with highlights working
- [ ] Cross-device sync working

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Components: `apps/web/src/components/bookmarks/`
- Frontend Pages: `apps/web/src/app/(dashboard)/bookmarks/page.tsx`
- Database Tables: `bookmarked_topics`, `text_highlights`, `note_annotations`

### Data Models

**Database Schema:**
```typescript
interface BookmarkedTopic {
  id: UUID
  user_id: UUID
  syllabus_node_id: UUID
  bookmarked_at: TIMESTAMPTZ
  notes: TEXT  -- Optional personal notes
}

interface TextHighlight {
  id: UUID
  user_id: UUID
  note_id: UUID
  start_offset: INTEGER
  end_offset: INTEGER
  selected_text: TEXT
  color: TEXT  -- 'yellow', 'green', 'pink', 'blue'
  created_at: TIMESTAMPTZ
}

interface NoteAnnotation {
  id: UUID
  user_id: UUID
  highlight_id: UUID
  annotation_text: TEXT
  created_at: TIMESTAMPTZ
}
```

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/bookmarks/**/*.test.tsx`

---

## Tasks / Subtasks

- [ ] **Task 1: Bookmark Button (AC: 1)**
  - [ ] 1.1 Create `BookmarkButton.tsx` component
  - [ ] 1.2 Add to syllabus topic cards and search results
  - [ ] 1.3 Toggle bookmark state on click

- [ ] **Task 2: Bookmark Database (AC: 2, 4)**
  - [ ] 2.1 Create `006_bookmarks.sql` migration
  - [ ] 2.2 Create `bookmarked_topics` table
  - [ ] 2.3 Create API endpoint to toggle bookmark
  - [ ] 2.4 Update TypeScript types

- [ ] **Task 3: My Bookmarks Page (AC: 3)**
  - [ ] 3.1 Create `apps/web/src/app/(dashboard)/bookmarks/page.tsx`
  - [ ] 3.2 List all bookmarks with filters
  - [ ] 3.3 Remove bookmark button on each item
  - [ ] 3.4 Add personal notes field

- [ ] **Task 4: Text Selection & Highlight (AC: 4-6)**
  - [ ] 4.1 Create `HighlightToolbar.tsx` component
  - [ ] 4.2 Detect text selection in notes
  - [ ] 4.3 Show toolbar on selection
  - [ ] 4.4 Color options: yellow (default), green, pink, blue
  - [ ] 4.5 Save highlight with position data

- [ ] **Task 5: Annotations (AC: 7-8)**
  - [ ] 5.1 Create `AnnotationTextbox.tsx` component
  - [ ] 5.2 Show on highlight click
  - [ ] 5.3 Save annotation to `note_annotations` table
  - [ ] 5.4 Display annotations in notes view

- [ ] **Task 6: Export Highlights (AC: 9)**
  - [ ] 6.1 Create `exportHighlightsPDF()` function
  - [ ] 6.2 Include highlighted text and annotations
  - [ ] 6.3 Download as PDF

- [ ] **Task 7: Cross-Device Sync (AC: 10)**
  - [ ] 7.1 All data stored in database
  - [ ] 7.2 Sync on page load
  - [ ] 7.3 Real-time updates via Supabase subscriptions

- [ ] **Task 8: Unit Tests**
  - [ ] 8.1 Test bookmark toggle
  - [ ] 8.2 Test highlight creation
  - [ ] 8.3 Test annotation save/load

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
