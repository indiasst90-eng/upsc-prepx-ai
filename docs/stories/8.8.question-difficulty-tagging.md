# Story 8.8: Question Bank - Difficulty Tagging & Adaptive System

**Epic:** 8 - Practice & Evaluation - PYQs & Question Bank
**Story Number:** 8.8
**Status:** COMPLETE
**Created:** December 23, 2025
**Completed:** December 28, 2025
**Sprint:** Sprint 9 (Epic 8)
**Estimated Effort:** Medium (M)
**Risk Level:** MEDIUM

---

## Story

**As a** UPSC aspirant,
**I want** questions to be tagged with accurate difficulty levels,
**so that** I can practice progressively and build confidence.

---

## Acceptance Criteria

1. [x] Difficulty classification: Easy (>70% success rate), Medium (40-70%), Hard (<40%)
2. [x] Initial tagging: AI assigns preliminary difficulty based on question complexity, depth, cross-topic references
3. [x] Dynamic adjustment: difficulty updates based on actual user performance data
4. [x] Database: adds difficulty_level and success_rate fields to `pyq_questions` and `generated_questions` tables
5. [x] Adaptive practice: recommends next question difficulty based on user's last 5 answers (3+ correct = increase difficulty)
6. [x] UI indicators: color-coded badges (Green=Easy, Yellow=Medium, Red=Hard) on question cards
7. [x] Progress tracking: shows user's comfort level at each difficulty (e.g., "80% accuracy on Easy, 55% on Medium")
8. [x] Filter by difficulty: users can filter practice sessions by difficulty level
9. [x] Analytics: tracks time spent per difficulty level, success rates, and improvement trends
10. [x] Gamification: badges for mastering 50 Hard questions, 100 Medium questions, etc.

---

## Implementation Summary

### Database (Migration 041 + 036)
- `predict_question_difficulty()` - AI difficulty prediction function
- `get_adaptive_recommendation()` - Adaptive practice recommendation
- `difficulty_badges` - User earned badges table
- `badge_definitions` - Badge requirements and metadata
- `user_difficulty_stats` - Aggregate performance by difficulty
- `check_and_award_badges()` - Auto-award badges function
- `get_difficulty_analytics()` - Analytics aggregation
- `get_difficulty_progress()` - Progress tracking per difficulty

### API Route (`/api/difficulty`)
- `POST action=predict_difficulty` - AI difficulty prediction
- `POST action=get_recommendation` - Adaptive recommendations
- `POST action=record_attempt` - Record question attempt
- `POST action=get_analytics` - Fetch analytics data
- `POST action=get_progress` - Fetch progress per difficulty
- `POST action=get_badges` - Fetch user badges
- `GET ?difficulty=<level>` - Filter questions by difficulty

### UI (`/practice/analytics`)
- Adaptive recommendation banner with next difficulty suggestion
- Progress tracking cards per difficulty level
- Color-coded difficulty badges (Green/Yellow/Red)
- 30-day accuracy trend chart
- Gamification badges section (earned, in-progress, locked)
- Quick practice links by difficulty

### Integration
- Question generation auto-tags difficulty using AI prediction
- Attempts trigger automatic difficulty recalculation
- Badge awards happen automatically on milestone achievements

---

## Dependencies

**Blocking:** Stories 8.2, 8.6, 0.3 (questions extracted/generated, A4F API)
**Blocks:** Story 8.9

---

## Definition of Done

- [x] All AC met
- [x] Difficulty tagging accurate
- [x] Adaptive system working
- [x] UI shows difficulty clearly
- [x] Tests passing

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 2.0 | Full implementation complete | Larry (DEV Agent) |
