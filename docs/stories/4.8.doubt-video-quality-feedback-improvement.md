# Story 4.8: Doubt Video Quality Feedback & Improvement

**Epic:** 4 - On-Demand Video Learning
**Story Number:** 4.8
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 5
**Estimated Effort:** Small (S)
**Risk Level:** LOW

---

## Story

**As a** product manager,
**I want** to collect user feedback on doubt video quality and track accuracy metrics,
**so that** I can continuously improve the video generation system.

---

## Acceptance Criteria

1. Feedback form on every doubt video: helpful (yes/no), accuracy (1-5 stars), comment
2. Feedback saved to video_feedback table
3. Admin dashboard: view feedback metrics, filter by low ratings
4. Flag for review: videos with <3 stars marked for admin review
5. Improvement tracking: re-rendered videos after feedback tracked separately
6. Analytics: avg rating per video type, common complaints categorized
7. A/B testing: test different script styles, track which performs better
8. User can report factual errors: form with error description, admin notified
9. Admin can approve/reject error reports
10. Approved corrections trigger video re-render with updated script

---

## Dependencies

**Blocking:** Story 4.5
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Feedback collection working
- [ ] Admin dashboard functional
- [ ] Error reporting working
- [ ] A/B testing framework ready

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Components: `apps/web/src/components/doubt/FeedbackForm.tsx`
- Admin Pages: `apps/admin/src/app/feedback/doubts/page.tsx`

### Data Models

**Database Schema:**
```typescript
interface VideoFeedback {
  id: UUID
  render_id: UUID NOT NULL
  user_id: UUID NOT NULL
  helpful: BOOLEAN
  accuracy_rating: INTEGER  -- 1-5
  comment?: TEXT
  created_at: TIMESTAMPTZ
}

interface ErrorReport {
  id: UUID
  render_id: UUID NOT NULL
  user_id: UUID NOT NULL
  error_description: TEXT
  status: TEXT  -- 'pending', 'approved', 'rejected', 'resolved'
  admin_reviewed_by?: UUID
  admin_reviewed_at?: TIMESTAMPTZ
  resolution_notes?: TEXT
  created_at: TIMESTAMPTZ
}
```

### API Specifications

**Feedback Endpoint:** `POST /api/doubts/{job_id}/feedback`
**Error Report Endpoint:** `POST /api/doubts/{job_id}/report-error`

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/doubt/**/*.test.tsx`

---

## Tasks / Subtasks

- [ ] **Task 1: Feedback Form (AC: 1, 2)**
  - [ ] 1.1 Create `FeedbackForm.tsx` component
  - [ ] 1.2 Thumbs up/down toggle
  - [ ] 1.3 Star rating (1-5 stars)
  - [ ] 1.4 Optional comment field
  - [ ] 1.5 Save to `video_feedback` table

- [ ] **Task 2: Admin Dashboard (AC: 3)**
  - [ ] 2.1 Create `apps/admin/src/app/feedback/doubts/page.tsx`
  - [ ] 2.2 View all feedback metrics
  - [ ] 2.3 Filter by low ratings (<3 stars)
  - [ ] 2.4 Charts: avg rating, common complaints

- [ ] **Task 3: Flagging (AC: 4)**
  - [ ] 3.1 Auto-flag videos with <3 stars
  - [ ] 3.2 Mark for admin review
  - [ ] 3.3 Priority queue for re-renders

- [ ] **Task 4: Improvement Tracking (AC: 5)**
  - [ ] 4.1 Track re-rendered videos separately
  - [ ] 4.2 Compare original vs re-render ratings
  - [ ] 4.3 Calculate improvement rate

- [ ] **Task 5: A/B Testing (AC: 6)**
  - [ ] 5.1 Create `ABTestConfig` table
  - [ ] 5.2 Test different script styles
  - [ ] 5.3 Randomly assign variants
  - [ ] 5.4 Track which performs better

- [ ] **Task 6: Error Reporting (AC: 7, 8)**
  - [ ] 6.1 Create `ReportErrorModal.tsx`
  - [ ] 6.2 Form: error description
  - [ ] 6.3 Admin notification
  - [ ] 6.4 Mark report as pending

- [ ] **Task 7: Admin Review (AC: 9)**
  - [ ] 7.1 Approve/reject error reports
  - [ ] 7.2 Add resolution notes
  - [ ] 7.3 Update report status

- [ ] **Task 8: Auto Re-render (AC: 10)**
  - [ ] 8.1 Trigger re-render on approved correction
  - [ ] 8.2 Update script with corrections
  - [ ] 8.3 Notify user when ready

- [ ] **Task 9: Unit Tests**
  - [ ] 9.1 Test feedback submission
  - [ ] 9.2 Test error report flow
  - [ ] 9.3 Test admin approval
  - [ ] 9.4 Test A/B variant assignment

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
