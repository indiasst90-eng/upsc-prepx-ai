# Story 10.3: Weekly Documentary - Current Affairs Analysis

**Epic:** 10 - Deep Learning Assets - Documentary Lectures & Weekly Analysis
**Story Number:** 10.3
**Status:** COMPLETE
**Created:** December 23, 2025
**Sprint:** Sprint 10 (Epic 10)
**Estimated Effort:** Large (L)
**Risk Level:** HIGH

---

## Story

**As a** UPSC aspirant,
**I want** a weekly 15-30 minute documentary synthesizing the week's current affairs,
**so that** I can understand how news events connect and their exam relevance.

---

## Acceptance Criteria

1. Trigger: every Sunday at 8 PM IST, Edge Function `generate_weekly_doc_pipe.ts`
2. Content aggregation: fetch all daily CA videos from past week
3. Topic extraction: identify top 15-20 most important topics from the week
4. Script structure:
   - Week overview (3 min): "This week in UPSC news..."
   - Top 5 stories (5 min each): deep dive with context and analysis
   - Economy/Polity/IR/Environment segments
   - Expert interviews: AI-simulated expert quotes via TTS
   - Quiz preview (2 min): questions viewers should be able to answer
5. Manim visuals: data charts, timeline animations, comparison graphics
6. Duration: 15-30 minutes depending on news volume
7. Render priority: lower than daily CA, higher than documentary lectures
8. Publish: available by Monday 8 AM
9. Archive: added to weekly documentary archive
10. Social media clips: generate 3x 60s clips for promotion

---

## Dependencies

**Blocking:** Stories 3.1-3.4 (Daily CA), 10.1
**Blocks:** Story 10.5

---

## Definition of Done

- [x] All AC met
- [x] Weekly documentary generated
- [x] Content exam-focused
- [x] Published on time
- [x] Tests passing

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 2.0 | Implementation complete - All 10 ACs verified | Quinn (QA Agent) |

---

## Implementation Summary

### Files Created:
1. **Migration 055**: `packages/supabase/migrations/055_weekly_documentary.sql`
   - `weekly_documentaries` table with render priority, publish schedule
   - `weekly_doc_segments` table for script segments
   - `weekly_doc_schedule` for cron job tracking
   - Functions: `create_weekly_documentary`, `aggregate_weekly_content`, `extract_weekly_topics`, `save_weekly_script`, `publish_weekly_documentary`, `add_social_clips`, `get_weekly_documentary_archive`

2. **API Route**: `apps/web/src/app/api/weekly-documentary/route.ts`
   - POST actions: trigger, aggregate, extract_topics, generate_script, request_manim, render, publish, generate_clips
   - GET: archive listing with year filter, single documentary with segments
   - Render priority: DAILY_CA=100, WEEKLY_DOC=50, DOCUMENTARY=25
   - Duration targets: 15-30 minutes

3. **UI Page**: `apps/web/src/app/(dashboard)/weekly-documentary/page.tsx`
   - Video player with segments list
   - Archive sidebar with year filter
   - Social clips display
   - Manim visuals section
   - Schedule info footer

4. **Edge Function**: `packages/supabase/functions/generate-weekly-doc-pipe/index.ts`
   - Scheduled trigger: Sunday 8 PM IST (Cron: 30 14 * * 0)
   - Week start/end calculation
   - Pipeline orchestration

---

**Story Status:** COMPLETE
**Risk Level:** HIGH
**Estimated Effort:** Large (L)
