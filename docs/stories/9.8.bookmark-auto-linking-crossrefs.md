# Story 9.8: Smart Bookmark System - Auto-linking & Cross-references

**Epic:** 9 - Advanced Learning Tools - Mindmaps, Bookmarks & Assistants
**Story Number:** 9.8
**Status:** COMPLETE
**Created:** December 23, 2025
**Sprint:** Sprint 10 (Epic 9)
**Estimated Effort:** Large (L)
**Risk Level:** MEDIUM

---

## Story

**As a** UPSC aspirant,
**I want** my bookmarks to automatically link to related content,
**so that** I can discover connections between topics and deepen my understanding.

---

## Acceptance Criteria

1. Auto-linking: when bookmarking content, system finds related notes, videos, PYQs using RAG semantic search
2. Relationship types: "Related Topics", "Related PYQs", "Related Videos", "Also Bookmarked By Others"
3. Edge Function: `link_bookmark_pipe.ts` processes linking after bookmark creation
4. Semantic matching: uses embeddings to find content with similar concepts (similarity threshold >0.7)
5. Database: `bookmark_links` table with bookmark_id, related_content_type, related_content_id, link_type, relevance_score
6. UI display: bookmark detail page shows "Related Content" section with cards
7. Smart suggestions: "You bookmarked Fundamental Rights. You might also like: Directive Principles, Emergency Provisions"
8. Cross-topic discovery: highlights connections across subjects (e.g., "Environment" bookmark links to Geography AND Science papers)
9. PYQ connection: shows past years when bookmarked concept appeared in exams
10. Processing time: linking completes within 5 seconds in background (doesn't block bookmark creation)

---

## Dependencies

**Blocking:** Stories 9.7, 1.7, 8.2 (bookmarks created, RAG search, PYQ database)
**Blocks:** Story 9.9

---

## Definition of Done

- [x] All AC met
- [x] Auto-linking accurate
- [x] Relationships relevant
- [x] Processing non-blocking
- [x] Tests passing

---

## Implementation Summary

### Database (Migration 050)
- `bookmark_links` table with all required fields (AC 5)
- `bookmark_link_queue` for background processing (AC 10)
- RPC functions: save_bookmark_links, get_bookmark_related_content, find_pyq_appearances, get_bookmark_suggestions
- Auto-queue trigger on bookmark creation

### API (`/api/bookmarks/links/route.ts`)
- GET: Fetch related content with enrichment (AC 6)
- POST: Trigger linking (non-blocking, < 5s) (AC 10)
- PUT: Process queue (for cron/worker)
- PATCH: Find PYQ appearances (AC 9)
- RAG semantic search integration with fallback (AC 1, 4)

### UI (`/bookmarks/[id]/page.tsx`)
- Related Content section with type tabs (AC 6)
- Smart Suggestions (AC 7)
- Cross-Subject Connections (AC 8)
- PYQ Appearances (AC 9)
- "Find Related Content" button with live result count

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 2.0 | Implementation complete - all 10 ACs met | Dev Agent |
