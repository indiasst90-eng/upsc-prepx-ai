# Story 4.5: Doubt Video - Response Interface & Player

**Epic:** 4 - On-Demand Video Learning
**Story Number:** 4.5
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 5
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** to see my doubt video as soon as it's ready with options to download, share, and provide feedback,
**so that** I can immediately learn from the explanation and revisit it later.

---

## Acceptance Criteria

1. Client polls job status: GET /api/jobs/{job_id} every 3 seconds
2. Progress indicator: animated stages (Analyzing → Script → Visuals → Assembling)
3. Video player loads when status = completed: autoplay, controls
4. Below video: transcript, source citations, related topics
5. Actions: Download, Share, Report issue, Ask follow-up
6. Feedback: thumbs up/down, comment box
7. Short notes: 5-7 bullet summary
8. Mini-quiz: 3 MCQs, instant feedback
9. Video saved to "My Doubts" history
10. Video starts playing within 1s of completion

---

## Dependencies

**Blocking:** Story 4.4
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Polling working
- [ ] Video player functional
- [ ] Download/share working
- [ ] Feedback working
- [ ] Quiz functional

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Pages: `apps/web/src/app/(dashboard)/doubts/[job_id]/page.tsx`
- Frontend Components: `apps/web/src/components/doubt/`
- Stores: `apps/web/src/stores/doubtStore.ts`

### Data Models

**Database Schema:**
```typescript
interface DoubtFeedback {
  id: UUID
  render_id: UUID NOT NULL
  user_id: UUID NOT NULL
  helpful: BOOLEAN
  accuracy_rating: INTEGER  -- 1-5 stars
  comment?: TEXT
  error_reported?: TEXT
  created_at: TIMESTAMPTZ
}

interface DoubtMiniQuiz {
  id: UUID
  render_id: UUID NOT NULL
  questions: JSONB  -- [{ question, options, correct_answer }]
  user_answers: JSONB
  score: INTEGER
}
```

### API Specifications

**Job Status Endpoint:** `GET /api/jobs/{job_id}`
- Response: `{ status, progress_percentage, estimated_complete }`

**Feedback Endpoint:** `POST /api/doubts/{job_id}/feedback`

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/doubt/**/*.test.tsx`

---

## Tasks / Subtasks

- [ ] **Task 1: Job Status Polling (AC: 1, 2)**
  - [ ] 1.1 Create `useJobStatus()` hook
  - [ ] 1.2 Poll every 3 seconds
  - [ ] 1.3 Animated progress stages:
    - Analyzing (10%)
    - Script (25%)
    - Visuals (50%)
    - Assembling (75%)
    - Ready (100%)

- [ ] **Task 2: Video Player (AC: 3)**
  - [ ] 2.1 Reuse CAVideoPlayer from Story 3.7
  - [ ] 2.2 Autoplay when status = completed
  - [ ] 2.3 Load within 1 second

- [ ] **Task 3: Transcript & Sources (AC: 4)**
  - [ ] 3.1 Create `TranscriptPanel.tsx` component
  - [ ] 3.2 Display full script text
  - [ ] 3.3 Show source citations from RAG
  - [ ] 3.4 Display related topics

- [ ] **Task 4: Actions (AC: 5)**
  - [ ] 4.1 Create `VideoActions.tsx` component
  - [ ] 4.2 Download: download video file
  - [ ] 4.3 Share: open share modal
  - [ ] 4.4 Report issue: open feedback form
  - [ ] 4.5 Ask follow-up: navigate to new doubt

- [ ] **Task 5: Feedback (AC: 6)**
  - [ ] 5.1 Create `FeedbackForm.tsx` component
  - [ ] 5.2 Thumbs up/down toggle
  - [ ] 5.3 Star rating (1-5)
  - [ ] 5.4 Optional comment

- [ ] **Task 6: Short Notes (AC: 7)**
  - [ ] 6.1 Create `ShortNotes.tsx` component
  - [ ] 6.2 Display 5-7 bullet summary
  - [ ] 6.3 Auto-generated from script
  - [ ] 6.4 Copy to clipboard button

- [ ] **Task 7: Mini Quiz (AC: 8)**
  - [ ] 7.1 Create `MiniQuiz.tsx` component
  - [ ] 7.2 Generate 3 MCQs from script
  - [ ] 7.3 Interactive answers with instant feedback
  - [ ] 7.4 Show score at end

- [ ] **Task 8: History Update (AC: 9)**
  - [ ] 8.1 Add to "My Doubts" on completion
  - [ ] 8.2 Update video history table
  - [ ] 8.3 Show in Story 4.7 library

- [ ] **Task 9: Unit Tests**
  - [ ] 9.1 Test polling behavior
  - [ ] 9.2 Test feedback submission
  - [ ] 9.3 Test quiz scoring
  - [ ] 9.4 Test note generation

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft → **Ready for Review**
