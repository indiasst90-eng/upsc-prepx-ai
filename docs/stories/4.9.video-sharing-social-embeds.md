# Story 4.9: Video Sharing & Social Embeds

**Epic:** 4 - On-Demand Video Learning
**Story Number:** 4.9
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 5
**Estimated Effort:** Small (S)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** to share my doubt videos and topic shorts on social media or with friends,
**so that** I can help others learn and promote the platform.

---

## Acceptance Criteria

1. Share button generates unique shareable URL: /share/doubt/{share_id}
2. Share page: video player, doubt text, no login required (public access)
3. Social share buttons: WhatsApp, Twitter, Facebook, LinkedIn, Copy Link
4. Open Graph meta tags: video thumbnail, title, description for rich previews
5. Embed code: iframe embed code for blogs/websites
6. View tracking: count views on shared videos
7. Attribution: "Created on UPSC PrepX-AI" watermark
8. Privacy: user can make video private (disable sharing)
9. Expiry: share links expire after 90 days (configurable)
10. Analytics: track shares per video, viral coefficient

---

## Dependencies

**Blocking:** Story 4.5
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Share links working
- [ ] Social buttons functional
- [ ] OG tags displaying correctly
- [ ] Embed code working
- [ ] Privacy controls working

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Pages: `apps/web/src/app/share/[share_id]/page.tsx`
- Frontend Components: `apps/web/src/components/doubt/ShareButton.tsx`

### Data Models

**Database Schema:**
```typescript
interface VideoShare {
  id: UUID
  video_id: UUID NOT NULL
  share_token: TEXT UNIQUE
  is_active: BOOLEAN DEFAULT true
  expires_at: TIMESTAMPTZ
  view_count: INTEGER DEFAULT 0
  created_by: UUID
  created_at: TIMESTAMPTZ
}
```

### API Specifications

**Share Endpoint:** `POST /api/videos/{video_id}/share`
- Response: `{ share_url, share_token, expires_at }`

**Share Page:** Public access (no auth required)

### Testing Standards

**Test File Location:**
- E2E Tests: `tests/video-sharing.spec.ts`

---

## Tasks / Subtasks

- [ ] **Task 1: Share Button (AC: 1, 5)**
  - [ ] 1.1 Create `ShareButton.tsx` component
  - [ ] 1.2 Add to video player (Story 4.5)
  - [ ] 1.3 Generate unique share URL
  - [ ] 1.4 Copy to clipboard

- [ ] **Task 2: Share Page (AC: 2)**
  - [ ] 2.1 Create `apps/web/src/app/share/[share_id]/page.tsx`
  - [ ] 2.2 Video player (no login required)
  - [ ] 2.3 Display doubt text
  - [ ] 2.4 Attribution: "Created on UPSC PrepX-AI"

- [ ] **Task 3: Social Sharing (AC: 3)**
  - [ ] 3.1 Create `SocialShareButtons.tsx` component
  - [ ] 3.2 WhatsApp, Twitter, Facebook, LinkedIn
  - [ ] 3.3 Pre-populated share text
  - [ ] 3.4 Track shares per video

- [ ] **Task 4: Open Graph Tags (AC: 4)**
  - [ ] 4.1 Add dynamic OG meta tags to share page
  - [ ] 4.2 Video thumbnail, title, description
  - [ ] 4.3 Twitter card meta tags
  - [ ] 4.4 Test rich previews

- [ ] **Task 5: Embed Code (AC: 5)**
  - [ ] 5.1 Create `EmbedCodeModal.tsx`
  - [ ] 5.2 Generate iframe code
  - [ ] 5.3 Format: `<iframe src="..."></iframe>`
  - [ ] 5.4 Copy button

- [ ] **Task 6: View Tracking (AC: 6)**
  - [ ] 6.1 Increment view_count on share page load
  - [ ] 6.2 Track in `video_shares` table
  - [ ] 6.3 Analytics: shares per video

- [ ] **Task 7: Privacy Controls (AC: 8)**
  - [ ] 7.1 "Make Private" toggle on share modal
  - [ ] 7.2 Deactivate share link
  - [ ] 7.3 Existing shares become inactive

- [ ] **Task 8: Expiry (AC: 9)**
  - [ ] 8.1 Set default expiry: 90 days
  - [ ] 8.2 Configurable by user
  - [ ] 8.3 Auto-deactivate expired links
  - [ ] 8.4 Notify user before expiry

- [ ] **Task 9: Analytics (AC: 10)**
  - [ ] 9.1 Track viral coefficient (shares per view)
  - [ ] 9.2 Top shared videos chart
  - [ ] 9.3 Sharing trends over time

- [ ] **Task 10: E2E Tests**
  - [ ] 10.1 Test share flow
  - [ ] 10.2 Test social sharing
  - [ ] 10.3 Test embed functionality
  - [ ] 10.4 Test privacy controls

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
