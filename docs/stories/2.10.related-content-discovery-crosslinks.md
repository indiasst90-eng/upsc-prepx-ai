# Story 2.10: Related Content Discovery & Cross-Links

**Epic:** 2 - Core Learning Features
**Story Number:** 2.10
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 3
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** to see related topics, videos, and PYQs when viewing any content,
**so that** I can explore connected concepts and reinforce learning through multiple formats.

---

## Acceptance Criteria

1. Related Content section on every notes page
2. AI identifies related topics using semantic similarity
3. Display related topics with relevance score
4. Show related videos (if available)
5. Show related PYQs with difficulty level
6. See All Related expands to full list
7. Cross-links within notes are clickable
8. Related content updates when user completes topics
9. User can manually link topics as related
10. Graph view shows all connections for a topic

---

## Dependencies

**Blocking:** Stories 2.3, 2.6
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Related content discovery working
- [ ] Semantic similarity working
- [ ] Cross-links functional
- [ ] Graph view implemented
- [ ] Manual linking working

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Components: `apps/web/src/components/notes/RelatedContent.tsx`
- Edge Functions: `packages/supabase/functions/pipes/discover_related_pipe/`
- Database Tables: `topic_relations`, `manual_topic_links`

### Data Models

**Database Schema:**
```typescript
interface TopicRelation {
  id: UUID
  source_node_id: UUID
  target_node_id: UUID
  relevance_score: DECIMAL  -- 0-1 cosine similarity
  relation_type: TEXT  -- 'related', 'prerequisite', 'builds_on', 'similar'
  created_at: TIMESTAMPTZ
}

interface ManualTopicLink {
  id: UUID
  user_id: UUID
  source_node_id: UUID
  target_node_id: UUID
  created_at: TIMESTAMPTZ
}
```

### API Specifications

**Edge Function:** `discover_related_pipe`
- Location: `packages/supabase/functions/pipes/discover_related_pipe/index.ts`
- Method: POST
- Request body: `{ topic_id: string, limit?: number }`
- Response: `{ related: RelatedTopic[], videos: Video[], pyqs: PYQ[] }`

### Testing Standards

**Test File Location:**
- Unit Tests: `packages/supabase/functions/pipes/discover_related_pipe/index.test.ts`

---

## Tasks / Subtasks

- [ ] **Task 1: Related Content Section (AC: 1)**
  - [ ] 1.1 Create `RelatedContent.tsx` component
  - [ ] 1.2 Add to every notes page
  - [ ] 1.3 Display: related topics, videos, PYQs

- [ ] **Task 2: Semantic Discovery (AC: 2)**
  - [ ] 2.1 Create `discover_related_pipe/index.ts`
  - [ ] 2.2 Query knowledge base for semantically similar topics
  - [ ] 2.3 Calculate relevance scores using vector similarity
  - [ ] 2.4 Return top 5 related topics

- [ ] **Task 3: Relevance Display (AC: 3)**
  - [ ] 3.1 Display related topics with relevance score
  - [ ] 3.2 Sort by relevance (highest first)
  - [ ] 3.3 Show relevance badge (e.g., "95% match")

- [ ] **Task 4: Related Videos (AC: 4)**
  - [ ] 4.1 Query `video_renders` table for topic-related videos
  - [ ] 4.2 Display video thumbnails with titles
  - [ ] 4.3 Link to video player

- [ ] **Task 5: Related PYQs (AC: 5)**
  - [ ] 5.1 Query `pyq_questions` for topic-related questions
  - [ ] 5.2 Filter by topic relevance
  - [ ] 5.3 Display with difficulty level badges

- [ ] **Task 6: Expandable List (AC: 6)**
  - [ ] 6.1 Create "See All Related" button
  - [ ] 6.2 Expand to full list modal
  - [ ] 6.3 Search within related content

- [ ] **Task 7: Cross-Links (AC: 7)**
  - [ ] 7.1 Parse notes for topic references
  - [ ] 7.2 Convert to clickable links
  - [ ] 7.3 Navigate to related topics on click

- [ ] **Task 8: Dynamic Updates (AC: 8)**
  - [ ] 8.1 Update related content when user completes topics
  - [ ] 8.2 Filter out already-completed topics
  - [ ] 8.3 Prioritize incomplete related topics

- [ ] **Task 9: Manual Linking (AC: 9)**
  - [ ] 9.1 Create `manual_topic_links` table
  - [ ] 9.2 "Link as related" button on topic cards
  - [ ] 9.3 Show manual links alongside AI-discovered ones

- [ ] **Task 10: Graph View (AC: 10)**
  - [ ] 10.1 Create `TopicGraphView.tsx` component
  - [ ] 10.2 Visualize all connections for a topic
  - [ ] 10.3 Use D3.js force-directed graph
  - [ ] 10.4 Click nodes to navigate

- [ ] **Task 11: Unit Tests**
  - [ ] 11.1 Test relevance scoring
  - [ ] 11.2 Test cross-link navigation
  - [ ] 11.3 Test graph rendering

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
