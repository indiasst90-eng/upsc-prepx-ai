# Story 8.6: Question Bank - AI Question Generator Interface

**Epic:** 8 - Practice & Evaluation - PYQs & Question Bank
**Story Number:** 8.6
**Status:** COMPLETE
**Created:** December 23, 2025
**Completed:** December 28, 2025
**Sprint:** Sprint 9 (Epic 8)
**Estimated Effort:** Medium (M)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** to generate unlimited practice questions on any topic,
**so that** I can practice extensively beyond PYQs.

---

## Acceptance Criteria

1. UI page: /practice/generate with topic input, question type selector (MCQ/Mains/Essay), difficulty level
2. Topic input: accepts text input or syllabus node selection from 3D navigator
3. Question type options: Prelims MCQ (4 options), Mains 150-word, Mains 250-word, Essay 1000-word
4. Difficulty selector: Easy/Medium/Hard (affects complexity and depth required)
5. Batch generation: generates 1-10 questions at once based on user selection
6. Edge Function: `generate_questions_pipe.ts` orchestrates generation
7. AI prompt: "Generate {count} UPSC {type} questions on {topic} at {difficulty} level with proper answer key"
8. Database: `generated_questions` table with user_id, topic, question_text, question_type, difficulty, options_json, model_answer
9. Quality control: validates generated questions (no duplicates, proper format, answer alignment)
10. Entitlement: Free users generate 5 questions/day, Pro users get unlimited

---

## Dependencies

**Blocking:** Stories 1.2, 1.3, 5.4, 0.3 (auth, database, entitlements, A4F API)
**Blocks:** Story 8.7

---

## Definition of Done

- [x] All AC met
- [x] Question generation working
- [x] Quality control effective
- [x] Entitlements enforced
- [x] Tests passing

---

## Implementation Summary

### Files Created/Modified

**Database Migration:**
- `packages/supabase/migrations/039_generated_questions.sql` - Created tables for generated_questions and question_generation_logs with RLS policies and tracking functions

**TypeScript Types:**
- `apps/web/src/types/database.types.ts` - Added generated_questions and question_generation_logs types

**API Route:**
- `apps/web/src/app/api/questions/generate/route.ts` - Complete implementation with:
  - POST: Generate questions with A4F API
  - GET: Fetch user's generated questions
  - Entitlement checking and recording
  - Quality validation
  - Database persistence

**UI Page:**
- `apps/web/src/app/(dashboard)/practice/generate/page.tsx` - Full production UI with:
  - Topic input with syllabus node selector
  - Question type selector (MCQ, Mains 150/250, Essay)
  - Difficulty selector (Easy/Medium/Hard)
  - Batch generation (1-10 questions)
  - Daily limit progress bar
  - Upgrade prompts for free tier
  - Question history
  - Practice mode integration

**Edge Function:**
- `packages/supabase/functions/pipes/generate_questions_pipe/index.ts` - Supabase Edge Function for question generation

### Acceptance Criteria Verification

| AC | Requirement | Status | Implementation |
|----|-------------|--------|----------------|
| 1 | UI page /practice/generate | ✅ | Full page with all controls |
| 2 | Topic input with syllabus selection | ✅ | Text input + syllabus tree selector |
| 3 | Question type options | ✅ | MCQ, Mains 150/250, Essay |
| 4 | Difficulty selector | ✅ | Easy/Medium/Hard with descriptions |
| 5 | Batch generation 1-10 | ✅ | Count input with validation |
| 6 | Edge Function | ✅ | generate_questions_pipe created |
| 7 | AI prompt with answer key | ✅ | Comprehensive prompt engineering |
| 8 | Database table | ✅ | Migration 039 with full schema |
| 9 | Quality control | ✅ | Validation in API route |
| 10 | Entitlements 5/day free | ✅ | RPC functions + UI enforcement |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 2.0 | Full implementation complete | BMAD DEV Agent |
