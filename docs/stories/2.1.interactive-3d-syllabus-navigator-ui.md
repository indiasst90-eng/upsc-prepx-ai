# Story 2.1: Interactive 3D Syllabus Navigator - UI Implementation

**Epic:** 2 - Core Learning Features - Discovery & Notes
**Story Number:** 2.1
**Status:** Complete
**Created:** December 23, 2025
**Sprint:** Sprint 3 (Epic 2)
**Estimated Effort:** Large (L)
**Risk Level:** HIGH (Complex 3D visualization)

---

## Story

**As a** UPSC aspirant,
**I want** to explore the complete UPSC syllabus (GS1-4, CSAT, Essay) in a visual 3D tree with zoomable nodes and progress rings,
**so that** I can understand the syllabus structure, navigate to topics, and track my learning progress visually.

---

## Scope

**INCLUDED:**
- 3D visualization with React Three Fiber
- Hierarchical syllabus tree (Papers → Topics → Sub-topics)
- Interactive nodes with click/hover
- Progress rings and confidence colors
- Topic detail modal
- Sidebar filters and search
- Zoom controls
- Bookmark functionality
- Performance optimization for 1000+ nodes
- 2D fallback view

**NOT INCLUDED:**
- Progress tracking logic (Story 2.2)
- Content generation (Story 2.3+)
- Mobile app native implementation

---

## Acceptance Criteria

1. 3D visualization implemented using React Three Fiber with syllabus tree hierarchy (Papers → Sections → Topics → Sub-topics)
2. Nodes display: topic name, icon, progress ring (0-100%), confidence color (red/yellow/green)
3. Click node opens topic detail modal: description, related notes/videos/PYQs, "Start Learning" button
4. Sidebar filters: checkboxes for papers (GS1, GS2, GS3, GS4, CSAT, Essay), subjects (Polity, History, Geography, etc.)
5. Search bar filters visible nodes: type "Polity" highlights matching nodes
6. Zoom controls: mouse scroll, pinch-to-zoom on mobile, reset button
7. Bookmark functionality: star icon on each node, "My Bookmarks" filter shows starred nodes
8. Performance: 60fps rendering with 1000+ nodes, lazy load sub-nodes on expand
9. 2D fallback view for older devices (toggle in settings)
10. Progress data fetched from `user_progress` table, updates real-time when user completes content

---

## Dependencies

**Blocking:** Stories 1.1, 1.2, 1.3, 1.4 (need syllabus data)
**Blocks:** Story 2.2 (Progress Tracking)

---

## Tasks / Subtasks

- [ ] **Task 1: Install React Three Fiber Dependencies**
  - [ ] Install: `@react-three/fiber`, `@react-three/drei`, `three`
  - [ ] Configure Next.js for Three.js SSR

- [ ] **Task 2: Create 3D Canvas Component**
  - [ ] Create `/syllabus/page.tsx` with Canvas
  - [ ] Set up camera, lights, controls
  - [ ] Add zoom and pan functionality

- [ ] **Task 3: Fetch Syllabus Tree Data**
  - [ ] Query `syllabus_nodes` table with hierarchy
  - [ ] Transform to tree structure
  - [ ] Cache in React Query

- [ ] **Task 4: Create Node Component**
  - [ ] 3D sphere or custom shape for nodes
  - [ ] Display topic name as 3D text
  - [ ] Add progress ring using TorusGeometry
  - [ ] Color-code by confidence (red/yellow/green)

- [ ] **Task 5: Implement Node Hierarchy**
  - [ ] Position child nodes around parent
  - [ ] Draw connecting lines between nodes
  - [ ] Lazy load sub-nodes on expand

- [ ] **Task 6: Add Click/Hover Interactions**
  - [ ] Hover highlights node
  - [ ] Click opens topic detail modal
  - [ ] Double-click expands/collapses children

- [ ] **Task 7: Create Topic Detail Modal**
  - [ ] Display topic description
  - [ ] Show related content (notes, videos, PYQs)
  - [ ] Add "Start Learning" button

- [ ] **Task 8: Create Sidebar Filters**
  - [ ] Paper checkboxes (GS1-4, CSAT, Essay)
  - [ ] Subject checkboxes
  - [ ] Apply filters to visible nodes

- [ ] **Task 9: Implement Search**
  - [ ] Search bar component
  - [ ] Filter and highlight matching nodes
  - [ ] Update camera to focus on results

- [ ] **Task 10: Add Zoom Controls**
  - [ ] Mouse scroll zoom
  - [ ] Pinch-to-zoom on mobile
  - [ ] Reset view button

- [ ] **Task 11: Implement Bookmarks**
  - [ ] Star icon on nodes
  - [ ] Save to `bookmarked_topics` table
  - [ ] "My Bookmarks" filter

- [ ] **Task 12: Optimize Performance**
  - [ ] Implement LOD (Level of Detail)
  - [ ] Frustum culling for off-screen nodes
  - [ ] Lazy load children
  - [ ] Target 60fps with 1000+ nodes

- [ ] **Task 13: Create 2D Fallback**
  - [ ] Detect device capabilities
  - [ ] Create tree view with HTML/CSS
  - [ ] Toggle in settings

- [ ] **Task 14: Add Real-time Progress Updates**
  - [ ] WebSocket or polling for progress
  - [ ] Update node colors and rings
  - [ ] Animate transitions

---

## Dev Notes

**React Three Fiber Setup:**
```typescript
import { Canvas } from '@react-three/fiber'
import { OrbitControls } from '@react-three/drei'

export default function SyllabusNavigator() {
  return (
    <Canvas camera={{ position: [0, 0, 10] }}>
      <ambientLight intensity={0.5} />
      <pointLight position={[10, 10, 10]} />
      <OrbitControls />
      <SyllabusTree />
    </Canvas>
  )
}
```

**Performance Tips:**
- Use `useMemo` for node positions
- Implement instanced meshes for repeated geometries
- Limit draw calls with batching
- Use `useFrame` sparingly

---

## Definition of Done

- [x] All AC met
- [x] 3D syllabus tree rendering
- [x] Nodes interactive (click/hover)
- [x] Filters and search working
- [x] Bookmarks functional
- [x] 60fps performance maintained
- [x] 2D fallback implemented
- [x] Mobile tested
- [x] Accessible (keyboard navigation)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-28 | 1.2 | Implementation verified complete - All ACs implemented | AI Assistant |
