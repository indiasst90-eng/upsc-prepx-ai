# Story 4.7: Video Library - "My Doubts" History & Organization

**Epic:** 4 - On-Demand Video Learning
**Story Number:** 4.7
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 5
**Estimated Effort:** Small (S)
**Risk Level:** LOW

---

## Story

**As a** UPSC aspirant,
**I want** a dedicated page showing all my doubt videos and topic shorts with search and filters,
**so that** I can easily revisit explanations and track my learning history.

---

## Acceptance Criteria

1. "My Doubts" page: /doubts route with grid/list toggle
2. Card displays: thumbnail, doubt text (first 100 chars), duration, created date
3. Filters: by type (text doubt, image doubt, voice doubt, topic short), by subject
4. Search: full-text search across doubt text
5. Sort: by date (newest/oldest), by topic, by video length
6. Pagination: 20 videos per page
7. Bulk delete: select multiple, delete confirmation
8. Export list: download CSV of all doubts with metadata
9. Analytics: total doubts asked, avg response time, most asked subjects
10. Mobile-optimized grid view

---

## Dependencies

**Blocking:** Story 4.5
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Page functional
- [ ] Filters working
- [ ] Search working
- [ ] Export working

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Pages: `apps/web/src/app/(dashboard)/doubts/page.tsx`
- Frontend Components: `apps/web/src/components/doubt/`

### Data Models

**Database Query:**
- Join `doubt_video_renders` + `topic_shorts` tables
- Filter by user_id

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/doubt/**/*.test.tsx`

---

## Tasks / Subtasks

- [ ] **Task 1: My Doubts Page (AC: 1)**
  - [ ] 1.1 Create `apps/web/src/app/(dashboard)/doubts/page.tsx`
  - [ ] 1.2 Grid/list toggle
  - [ ] 1.3 Mobile-responsive layout

- [ ] **Task 2: Video Cards (AC: 2)**
  - [ ] 2.1 Create `DoubtVideoCard.tsx` component
  - [ ] 2.2 Display: thumbnail, doubt text (100 chars), duration, date
  - [ ] 2.3 Quick actions: play, share, delete

- [ ] **Task 3: Filters (AC: 3)**
  - [ ] 3.1 Create `DoubtFilters.tsx` component
  - [ ] 3.2 Filter by type: text doubt, image doubt, voice doubt, topic short
  - [ ] 3.3 Filter by subject
  - [ ] 3.4 Apply filters to query

- [ ] **Task 4: Search (AC: 4)**
  - [ ] 4.1 Create `DoubtSearchBar.tsx` component
  - [ ] 4.2 Full-text search across doubt text
  - [ ] 4.3 Real-time filtering

- [ ] **Task 5: Sorting (AC: 5)**
  - [ ] 5.1 Create `DoubtSortDropdown.tsx`
  - [ ] 5.2 Options: date (newest/oldest), topic, video length
  - [ ] 5.3 Apply sort to query

- [ ] **Task 6: Pagination (AC: 6)**
  - [ ] 6.1 Implement 20 videos per page
  - [ ] 6.2 Page numbers navigation
  - [ ] 6.3 Infinite scroll option for mobile

- [ ] **Task 7: Bulk Actions (AC: 7)**
  - [ ] 7.1 Checkbox on each card
  - [ ] 7.2 Select all / deselect all
  - [ ] 7.3 Bulk delete with confirmation
  - [ ] 7.4 Bulk export

- [ ] **Task 8: Export (AC: 8)**
  - [ ] 8.1 Create `exportDoubtsCSV()` function
  - [ ] 8.2 Include: date, topic, video_url, duration
  - [ ] 8.3 Download as .csv file

- [ ] **Task 9: Analytics (AC: 9)**
  - [ ] 9.1 Create `DoubtAnalytics.tsx` component
  - [ ] 9.2 Stats: total doubts asked, avg response time
  - [ ] 9.3 Chart: most asked subjects
  - [ ] 9.4 Time series: doubts per week

- [ ] **Task 10: Unit Tests**
  - [ ] 10.1 Test filtering
  - [ ] 10.2 Test search
  - [ ] 10.3 Test export format
  - [ ] 10.4 Test analytics calculation

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
