# Story 8.2: PYQ System - Question Extraction with OCR

**Epic:** 8 - Practice & Evaluation - PYQs & Question Bank
**Story Number:** 8.2
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 9 (Epic 8)
**Estimated Effort:** Large (L)
**Risk Level:** HIGH

---

## Story

**As a** system,
**I want** to automatically extract individual questions from PYQ PDFs using OCR,
**so that** each question can be stored and processed separately.

---

## Acceptance Criteria

1. OCR processing: uses A4F image model (provider-3/gemini-2.5-flash) for OCR on each PDF page
2. Edge Function: `process_pyq_pipe.ts` orchestrates extraction pipeline
3. Question detection: identifies question boundaries using markers (Q1., Q2., etc.) and numbering patterns
4. Question parsing: extracts question text, marks (if mentioned), word limit (for Mains)
5. MCQ handling: for Prelims, extracts question + 4 options + correct answer if marked
6. Database: `pyq_questions` table with paper_id, question_number, question_text, question_type, options_json, marks, answer_text
7. Auto-classification: uses AI to classify question by subject (Polity, History, Geography, etc.) and syllabus topic
8. Quality check: flags low-confidence extractions for manual review
9. Batch processing: processes questions in batches of 10 to avoid timeouts
10. Error handling: logs failed extractions to `job_logs` table for debugging

---

## Dependencies

**Blocking:** Stories 8.1, 0.3 (PDF uploaded, A4F API)
**Blocks:** Story 8.3

---

## Definition of Done

- [ ] All AC met
- [ ] OCR extraction accurate (>95%)
- [ ] Questions classified correctly
- [ ] Error handling robust
- [ ] Tests passing

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
