# Story 2.9: Topic Mindmap Generator

**Epic:** 2 - Core Learning Features
**Story Number:** 2.9
**Status:** Draft
**Created:** December 23, 2025
**Sprint:** Sprint 3
**Estimated Effort:** Large (L)
**Risk Level:** MEDIUM

---

## Story

**As a** UPSC aspirant,
**I want** to generate interactive mind maps for complex topics showing relationships and hierarchies,
**so that** I can visualize connections between concepts for better retention.

---

## Acceptance Criteria

1. Generate Mindmap button on topic detail modal
2. LLM extracts key concepts and relationships from topic content
3. Mindmap data structure: central node, branches, sub-branches
4. Interactive visualization using D3.js or React Flow
5. Nodes clickable to expand/collapse
6. Export mindmap as PNG or SVG
7. Share mindmap with unique URL
8. Mindmap saved to user's library
9. Collaborative editing: multiple users can contribute (future enhancement)
10. Mobile-optimized: pinch-to-zoom, pan gestures

---

## Dependencies

**Blocking:** Story 2.3
**Blocks:** None

---

## Definition of Done

- [ ] All AC met
- [ ] Mindmap generation functional
- [ ] Interactive visualization working
- [ ] Export working
- [ ] Share functionality working
- [ ] Mobile tested

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Initial story creation | Bob (SM Agent) |
| 2025-12-24 | 1.1 | Added Dev Notes and Tasks/Subtasks | Bob (SM Agent) |

---

## Dev Notes

### Relevant Source Tree Info

**File Locations:**
- Frontend Components: `apps/web/src/components/mindmap/`
- Frontend Pages: `apps/web/src/app/(dashboard)/mindmaps/`
- Visualization Lib: React Flow or D3.js

### Data Models

**Database Schema:**
```typescript
interface Mindmap {
  id: UUID
  user_id: UUID
  syllabus_node_id: UUID
  title: TEXT
  nodes: JSONB  -- { id, label, x, y, parent_id }
  edges: JSONB  -- { id, source, target }
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}
```

### API Specifications

**Edge Function:** `generate_mindmap_pipe`
- Location: `packages/supabase/functions/pipes/generate_mindmap_pipe/index.ts`
- Method: POST
- Response: `{ mindmap_id: string, nodes: MindmapNode[], edges: MindmapEdge[] }`

### Testing Standards

**Test File Location:**
- Unit Tests: `apps/web/src/components/mindmap/**/*.test.tsx`

---

## Tasks / Subtasks

- [ ] **Task 1: Mindmap Button (AC: 1)**
  - [ ] 1.1 Create `GenerateMindmapButton.tsx`
  - [ ] 1.2 Add to topic detail modal
  - [ ] 1.3 Show loading state during generation

- [ ] **Task 2: LLM Concept Extraction (AC: 2)**
  - [ ] 2.1 Create `extractConceptsFromTopic()` function
  - [ ] 2.2 Call A4F LLM to identify key concepts and relationships
  - [ ] 2.3 Return: central node, branches, sub-branches

- [ ] **Task 3: Mindmap Data Structure (AC: 3)**
  - [ ] 3.1 Define MindmapNode and MindmapEdge interfaces
  - [ ] 3.2 Create `mindmaps` table in database
  - [ ] 3.3 Save generated mindmap to database

- [ ] **Task 4: Interactive Visualization (AC: 4)**
  - [ ] 4.1 Install React Flow or D3.js
  - [ ] 4.2 Create `MindmapViewer.tsx` component
  - [ ] 4.3 Render nodes and edges
  - [ ] 4.4 Smooth animations and transitions

- [ ] **Task 5: Node Expand/Collapse (AC: 5)**
  - [ ] 5.1 Implement expand/collapse on node click
  - [ ] 5.2 Show/hide child nodes
  - [ ] 5.3 Animate transitions

- [ ] **Task 6: Export (AC: 6)**
  - [ ] 6.1 Export as PNG: use html-to-image
  - [ ] 6.2 Export as SVG: use React Flow export
  - [ ] 6.3 Download buttons in UI

- [ ] **Task 7: Share (AC: 7)**
  - [ ] 7.1 Generate unique shareable URL: `/mindmaps/{mindmap_id}`
  - [ ] 7.2 Copy link to clipboard
  - [ ] 7.3 Read-only view for shared links

- [ ] **Task 8: Mindmap Library (AC: 8)**
  - [ ] 8.1 Create `apps/web/src/app/(dashboard)/mindmaps/page.tsx`
  - [ ] 8.2 Grid view of all user's mindmaps
  - [ ] 8.3 Open mindmap on click

- [ ] **Task 9: Mobile Optimization (AC: 10)**
  - [ ] 9.1 Pinch-to-zoom using react-use-gesture
  - [ ] 9.2 Pan gestures for navigation
  - [ ] 9.3 Touch-friendly controls

- [ ] **Task 10: Unit Tests**
  - [ ] 10.1 Test concept extraction
  - [ ] 10.2 Test visualization rendering
  - [ ] 10.3 Test export functionality

---

## QA Results

**Validation Date:** December 24, 2025
**Validated By:** Bob (SM Agent) - Story Draft Checklist

| Category                             | Status | Issues |
| ------------------------------------ | ------ | ------ |
| 1. Goal & Context Clarity            | PASS   | None   |
| 2. Technical Implementation Guidance | PASS   | None   |
| 3. Reference Effectiveness           | PASS   | None   |
| 4. Self-Containment Assessment       | PASS   | None   |
| 5. Testing Guidance                  | PASS   | None   |

**Final Assessment:** READY - The story provides sufficient context for implementation

**Story Status:** Draft â†’ **Ready for Review**
